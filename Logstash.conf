# ------------------------------------------------------------------------------
# Logstash Pipeline Configuration
# Receives logs from Beats on port 5044 and indexes them into Elasticsearch
# ------------------------------------------------------------------------------

input {
  beats {
    port => 5044
  }
}

filter {
  # Adds an ingestion timestamp to help with debugging latency
  mutate {
    copy => { "@timestamp" => "event.ingested" }
  }
}

output {
  # ---------------------------------------------------------
  # Logic to separate data streams based on the Agent Type
  # ---------------------------------------------------------
  
  elasticsearch {
    hosts => ["https://localhost:9200"]
    user => "elastic"
    password => "<YOUR_ELASTIC_PASSWORD>"
    ssl_enabled => true
    ssl_verification_mode => "none"

    # Dynamically names the index based on the beat (e.g., filebeat-2025.11.16)
    # This bypasses the need for complex Ingest Pipelines setup errors.
    index => "%{[agent][type]}-%{+YYYY.MM.dd}"
  }
}
